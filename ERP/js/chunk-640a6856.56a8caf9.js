(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-640a6856"],{"80fd":function(t,e,i){"use strict";i.r(e),i.d(e,"BillModalMixin",(function(){return s}));i("e2e0");var a=i("4ec3"),o=i("0fea"),n=i("ca00"),r=i("2b0e"),s={data:function(){return{action:"",manyAccountBtnStatus:!1,supList:[],cusList:[],retailList:[],personList:{options:[],value:""},depotList:[],accountList:[],accountIdList:[],accountMoneyList:[],billUnitPirce:"",spans:{labelCol1:{span:2},wrapperCol1:{span:22},labelCol1_5:{span:3},wrapperCol1_5:{span:21},labelCol2:{span:4},wrapperCol2:{span:20},labelCol3:{span:6},wrapperCol3:{span:18},labelCol6:{span:12},wrapperCol6:{span:12}}}},created:function(){},computed:{readOnly:function(){return"add"!==this.action&&"edit"!==this.action}},methods:{addInit:function(t){var e=this;Object(o["c"])("/sequence/buildNumber").then((function(i){i&&200===i.code&&e.form.setFieldsValue({number:t+i.data.defaultNumber})})),this.$nextTick((function(){e.form.setFieldsValue({operTime:Object(n["g"])(),discount:0,discountMoney:0,discountLastMoney:0,otherMoney:0,changeAmount:0,debt:0})})),this.$nextTick((function(){Object(a["ib"])({}).then((function(t){if(t&&200===t.code){var i=!0,a=!1,o=void 0;try{for(var n,r=t.data.accountList[Symbol.iterator]();!(i=(n=r.next()).done);i=!0){var s=n.value;s.isDefault&&e.form.setFieldsValue({accountId:s.id})}}catch(l){a=!0,o=l}finally{try{i||null==r.return||r.return()}finally{if(a)throw o}}}}))})),this.accountIdList=[],this.accountMoneyList=[],this.manyAccountBtnStatus=!1},initSupplier:function(){var t=this;Object(a["db"])({}).then((function(e){e&&(t.supList=e)}))},initCustomer:function(){var t=this;Object(a["bb"])({}).then((function(e){e&&(t.cusList=e)}))},initRetail:function(){var t=this;Object(a["cb"])({}).then((function(e){e&&(t.retailList=e)}))},initSalesman:function(){var t=this;Object(a["pb"])({type:1}).then((function(e){e&&(t.personList.options=e)}))},initDepot:function(){var t=this;Object(o["c"])("/depot/findDepotByCurrentUser").then((function(e){if(200===e.code){var i=e.data,a=!0,o=!1,n=void 0;try{for(var r,s=t.materialTable.columns[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){var l=r.value;if("depotId"==l.key||"anotherDepotId"==l.key){l.options=[];for(var c=0;c<i.length;c++){var d={};d.value=i[c].id+"",d.text=i[c].depotName,d.title=i[c].depotName,l.options.push(d)}}}}catch(u){o=!0,n=u}finally{try{a||null==s.return||s.return()}finally{if(o)throw n}}}}))},initAccount:function(){var t=this;Object(a["ib"])({}).then((function(e){if(e&&200===e.code){var i=e.data.accountList;i.splice(0,0,{id:0,name:"多账户"}),t.accountList=i}}))},handleManyAccount:function(){this.selectAccount(0)},selectAccount:function(t){0===t?(this.$refs.manyAccountModalForm.edit(this.accountIdList,this.accountMoneyList),this.$refs.manyAccountModalForm.title="多账户结算",this.manyAccountBtnStatus=!0):(this.accountIdList=[],this.accountMoneyList=[],this.manyAccountBtnStatus=!1)},manyAccountModalFormOk:function(t,e,i){var a=this;this.accountIdList=t,this.accountMoneyList=e;var o=this.form.getFieldValue("discountLastMoney")-0,n=this.form.getFieldValue("otherMoney")-0,r=(o+n-i).toFixed(2);this.$nextTick((function(){a.form.setFieldsValue({changeAmount:i,debt:r})}))},onAdded:function(t){var e=t.row,i=t.target;Object(o["c"])("/depot/findDepotByCurrentUser").then((function(t){if(200===t.code)for(var a=t.data,o=0;o<a.length;o++)a[o].isDefault&&i.setValues([{rowKey:e.id,values:{depotId:a[o].id+""}}])}))},onValueChange:function(t){var e,i,o,s,l,c,d,u,f=this,m=this,h=(t.type,t.row),p=t.column,y=t.value,b=t.target;switch(p.key){case"depotId":h.barCode&&m.getStockByDepotBarCode(h,b);break;case"barCode":e={barCode:y,mpList:Object(n["f"])(r["a"].ls.get("materialPropertyList")),prefixNo:this.prefixNo},Object(a["mb"])(e).then((function(t){if(t&&200===t.code){var e=t.data;if(y.indexOf(",")>-1)f.$refs.materialDataTable.getValues((function(t,i){i.pop();for(var a=i,o=0;o<e.length;o++){var n=e[o],r=f.parseInfoToObj(n);r.depotId=n.depotId,r.stock=n.stock,a.push(r)}for(var s=0,l=0;l<a.length;l++)s+=a[l].taxLastMoney-0;f.materialTable.dataSource=a,b.statisticsColumns.taxLastMoney=s,m.autoChangePrice(b)}));else{for(var i=[],a=0;a<e.length;a++){var o=e[a],n={rowKey:h.id,values:f.parseInfoToObj(o)};i.push(n)}b.setValues(i),m.getStockByDepotBarCode(h,b),b.recalcAllStatisticsColumns(),m.autoChangePrice(b)}}}));break;case"operNumber":i=y-0,c=h.taxRate-0,o=h.unitPrice-0,s=h.taxUnitPrice-0,l=(o*i).toFixed(2)-0,d=(.01*c*l).toFixed(2)-0,u=(l+d).toFixed(2)-0,b.setValues([{rowKey:h.id,values:{allPrice:l,taxMoney:d,taxLastMoney:u}}]),b.recalcAllStatisticsColumns(),m.autoChangePrice(b);break;case"unitPrice":i=h.operNumber-0,o=y-0,c=h.taxRate-0,s=(o*(1+.01*c)).toFixed(2)-0,l=(o*i).toFixed(2)-0,d=(.01*c*l).toFixed(2)-0,u=(l+d).toFixed(2)-0,b.setValues([{rowKey:h.id,values:{taxUnitPrice:s,allPrice:l,taxMoney:d,taxLastMoney:u}}]),b.recalcAllStatisticsColumns(),m.autoChangePrice(b);break;case"allPrice":i=h.operNumber-0,c=h.taxRate-0,l=y-0,o=(l/i).toFixed(2)-0,s=(o*(1+.01*c)).toFixed(2)-0,d=(.01*c*l).toFixed(2)-0,u=(l+d).toFixed(2)-0,b.setValues([{rowKey:h.id,values:{unitPrice:o,taxUnitPrice:s,taxMoney:d,taxLastMoney:u}}]),b.recalcAllStatisticsColumns(),m.autoChangePrice(b);break;case"taxRate":i=h.operNumber-0,l=h.allPrice-0,o=h.unitPrice-0,c=y-0,s=(o*(1+.01*c)).toFixed(2)-0,d=(.01*c*l).toFixed(2)-0,u=(l+d).toFixed(2)-0,b.setValues([{rowKey:h.id,values:{taxUnitPrice:s,taxMoney:d,taxLastMoney:u}}]),b.recalcAllStatisticsColumns(),m.autoChangePrice(b);break;case"taxLastMoney":i=h.operNumber-0,u=y-0,c=h.taxRate-0,s=(u/i).toFixed(2)-0,o=(s/(1+.01*c)).toFixed(2)-0,l=(o*i).toFixed(2)-0,d=(u-l).toFixed(2)-0,b.setValues([{rowKey:h.id,values:{unitPrice:o,taxUnitPrice:s,allPrice:l,taxMoney:d}}]),b.recalcAllStatisticsColumns(),m.autoChangePrice(b);break}},parseInfoToObj:function(t){return{barCode:t.mBarCode,name:t.name,standard:t.standard,model:t.model,materialOther:t.materialOther,unit:t.commodityUnit,sku:t.sku,operNumber:1,unitPrice:t.billPrice,taxUnitPrice:t.billPrice,allPrice:t.billPrice,taxRate:0,taxMoney:0,taxLastMoney:t.billPrice}},onDeleted:function(t,e){e.recalcAllStatisticsColumns(),this.autoChangePrice(e)},getStockByDepotBarCode:function(t,e){Object(a["gb"])({depotId:t.depotId,barCode:t.barCode}).then((function(i){i&&200===i.code&&(e.setValues([{rowKey:t.id,values:{stock:i.data.stock}}]),e.recalcAllStatisticsColumns())}))},autoChangePrice:function(t){var e=this,i=t.statisticsColumns.taxLastMoney-0,a=this.form.getFieldValue("discount")-0,o=this.form.getFieldValue("otherMoney")-0,n=(.01*a*i).toFixed(2)-0,r=(i-n).toFixed(2)-0,s=(r+o).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({discount:a,discountMoney:n,discountLastMoney:r,changeAmount:s,debt:0})}))},onKeyUpDiscount:function(t){var e=this,i=t.target.value-0,a=this.form.getFieldValue("discountMoney")-0,o=this.form.getFieldValue("discountLastMoney")-0,n=this.form.getFieldValue("otherMoney")-0,r=(a+o).toFixed(2)-0,s=(r*i*.01).toFixed(2)-0,l=(r-s).toFixed(2)-0,c=(l+n).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({discountMoney:s,discountLastMoney:l,changeAmount:c,debt:0})}))},onKeyUpDiscountMoney:function(t){var e=this,i=t.target.value-0,a=this.form.getFieldValue("discount")-0,o=this.form.getFieldValue("discountLastMoney")-0,n=this.form.getFieldValue("otherMoney")-0;if(100!==a){var r=(o/(1-a/100)).toFixed(2)-0,s=(i/r*100).toFixed(2)-0,l=(r-i).toFixed(2)-0,c=(l+n).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({discount:s,discountLastMoney:l,changeAmount:c,debt:0})}))}},onKeyUpOtherMoney:function(t){var e=this,i=t.target.value-0,a=this.form.getFieldValue("discountLastMoney")-0,o=(a+i).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({changeAmount:o,debt:0})}))},onKeyUpChangeAmount:function(t){var e=this,i=t.target.value-0,a=this.form.getFieldValue("discountLastMoney")-0,o=this.form.getFieldValue("otherMoney")-0,n=(a+o-i).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({debt:n})}))}}}},d0ed:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var a=i("7550"),o=i("e2e0"),n=i("0fea"),r={components:{JEditableTable:a["default"]},data:function(){return{title:"操作",visible:!1,form:this.$form.createForm(this),confirmLoading:!1,model:{},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}},methods:{getAllTable:function(){var t=this;if(!(this.refKeys instanceof Array))throw this.throwNotArray("refKeys");var e=this.refKeys.map((function(e){return Object(o["c"])(t,e)}));return Promise.all(e)},eachAllTable:function(t){this.getAllTable().then((function(e){e.forEach((function(e,i){"function"===typeof t&&t(e,i)}))}))},add:function(){"function"===typeof this.addBefore&&this.addBefore();var t=this.addDefaultRowNum;"number"!==typeof t&&(t=1),this.eachAllTable((function(e){e.add(t)})),"function"===typeof this.addAfter&&this.addAfter(this.model),this.edit({})},edit:function(t){"function"===typeof this.editBefore&&this.editBefore(t),this.visible=!0,this.activeKey=this.refKeys[0],this.form.resetFields(),this.model=Object.assign({},t),"function"===typeof this.editAfter&&this.editAfter(this.model)},close:function(){this.visible=!1,this.eachAllTable((function(t){t.initialize()})),this.$emit("close")},requestSubTableData:function(t,e,i,a){i.loading=!0,Object(n["c"])(t,e).then((function(t){t&&200===t.code&&(i.dataSource=t.data.rows,"function"===typeof a&&a(t))})).finally((function(){i.loading=!1}))},request:function(t){var e=this,i=this.url.add,a="post";this.model.id&&(i=this.url.edit,a="put"),this.confirmLoading=!0,Object(n["e"])(i,t,a).then((function(t){200===t.code?(e.$emit("ok"),e.confirmLoading=!1,e.close()):(e.$message.warning(t.data.message),e.confirmLoading=!1)})).finally((function(){}))},handleChangeTabs:function(t){Object(o["c"])(this,t).then((function(t){t.resetScrollTop()}))},handleCancel:function(){this.close()},handleOk:function(){var t=this;this.getAllTable().then((function(e){return Object(o["d"])(t.form,e)})).then((function(e){if("function"!==typeof t.classifyIntoFormData)throw t.throwNotFunction("classifyIntoFormData");var i=t.classifyIntoFormData(e);return t.request(i)})).catch((function(e){e.error===o["b"]&&(t.activeKey=null==e.index?t.activeKey:t.refKeys[e.index])}))},throwNotFunction:function(t){return"".concat(t," 未定义或不是一个函数")},throwNotArray:function(t){return"".concat(t," 未定义或不是一个数组")}}}},d921:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("j-modal",{staticStyle:{top:"5%",height:"100%","overflow-y":"hidden"},attrs:{title:t.title,width:t.width,visible:t.visible,confirmLoading:t.confirmLoading,maskClosable:!1,keyboard:!1,forceRender:!0,switchFullscreen:"",wrapClassName:"ant-modal-cust-warp"},on:{ok:t.handleOk,cancel:t.handleCancel}},[i("a-spin",{attrs:{spinning:t.confirmLoading}},[i("a-form",{attrs:{form:t.form}},[i("a-row",{staticClass:"form-row",attrs:{gutter:24}},[i("a-col",{attrs:{lg:6,md:12,sm:24}},[i("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"单据日期"}},[i("j-date",{directives:[{name:"decorator",rawName:"v-decorator",value:["operTime",t.validatorRules.operTime],expression:"['operTime', validatorRules.operTime]"}],attrs:{"show-time":!0}})],1)],1),i("a-col",{attrs:{lg:6,md:12,sm:24}},[i("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"单据编号"}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["number"],expression:"[ 'number' ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入单据编号",readOnly:!0}})],1)],1),i("a-col",{attrs:{lg:6,md:12,sm:24}}),i("a-col",{attrs:{lg:6,md:12,sm:24}})],1),i("j-editable-table",{ref:t.refKeys[0],attrs:{loading:t.materialTable.loading,columns:t.materialTable.columns,dataSource:t.materialTable.dataSource,maxHeight:300,rowNumber:!1,rowSelection:!0,actionButton:!0},on:{valueChange:t.onValueChange,added:t.onAdded,deleted:t.onDeleted}}),i("a-row",{staticClass:"form-row",attrs:{gutter:24}},[i("a-col",{attrs:{lg:24,md:24,sm:24}},[i("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:{xs:{span:24},sm:{span:24}},label:""}},[i("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark"],expression:"[ 'remark' ]"}],staticStyle:{"margin-top":"8px"},attrs:{rows:2,placeholder:"请输入备注"}})],1)],1)],1),i("a-row",{staticClass:"form-row",attrs:{gutter:24}},[i("a-col",{attrs:{lg:6,md:12,sm:24}},[i("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"附件"}},[i("j-upload",{attrs:{bizPath:"bill"},model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})],1)],1)],1)],1)],1)],1)},o=[],n=i("88bc"),r=i.n(n),s=i("e2e0"),l=i("d0ed"),c=i("80fd"),d=i("0fea"),u=i("ca00"),f=i("cf74"),m=i("2dab"),h=i("2b0e"),p={name:"AssembleModal",mixins:[l["a"],c["BillModalMixin"]],components:{JUpload:f["default"],JDate:m["default"]},data:function(){return{title:"操作",width:"1600px",moreStatus:!1,addDefaultRowNum:1,visible:!1,operTimeStr:"",prefixNo:"ZZD",fileList:[],model:{},labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}},refKeys:["materialDataTable"],activeKey:"materialDataTable",materialTable:{loading:!1,dataSource:[],columns:[{title:"商品类型",key:"mType",width:"7%",type:s["a"].input,readonly:!0},{title:"仓库名称",key:"depotId",width:"7%",type:s["a"].select,placeholder:"请选择${title}",options:[],allowSearch:!0,validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"条码",key:"barCode",width:"8%",type:s["a"].popupJsh,multi:!0,validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"名称",key:"name",width:"6%",type:s["a"].input,readonly:!0},{title:"规格",key:"standard",width:"5%",type:s["a"].input,readonly:!0},{title:"型号",key:"model",width:"5%",type:s["a"].input,readonly:!0},{title:"扩展信息",key:"materialOther",width:"5%",type:s["a"].input,readonly:!0},{title:"库存",key:"stock",width:"5%",type:s["a"].input,readonly:!0},{title:"单位",key:"unit",width:"4%",type:s["a"].input,readonly:!0},{title:"多属性",key:"sku",width:"4%",type:s["a"].input,readonly:!0},{title:"数量",key:"operNumber",width:"5%",type:s["a"].inputNumber,statistics:!0,validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"单价",key:"unitPrice",width:"5%",type:s["a"].inputNumber},{title:"金额",key:"allPrice",width:"5%",type:s["a"].inputNumber,statistics:!0},{title:"备注",key:"remark",width:"5%",type:s["a"].input}]},confirmLoading:!1,validatorRules:{operTime:{rules:[{required:!0,message:"请输入单据日期!"}]},type:{rules:[{required:!0,message:"请选择类型!"}]}},url:{add:"/depotHead/addDepotHeadAndDetail",edit:"/depotHead/updateDepotHeadAndDetail",detailList:"/depotItem/getDetailList"}}},created:function(){},methods:{editAfter:function(){var t=this;if("add"===this.action)this.addInit(this.prefixNo),this.fileList=[];else{this.model.operTime=this.model.operTimeStr,this.model.debt=(this.model.discountLastMoney-this.model.changeAmount).toFixed(2),this.fileList=this.model.fileName,this.$nextTick((function(){t.form.setFieldsValue(r()(t.model,"organId","operTime","number","remark","discount","discountMoney","discountLastMoney","otherMoney","accountId","changeAmount","debt"))}));var e={headerId:this.model.id,mpList:Object(u["f"])(h["a"].ls.get("materialPropertyList"))},i=(this.readOnly,this.url.detailList);this.requestSubTableData(i,e,this.materialTable)}this.initDepot()},classifyIntoFormData:function(t){var e=0,i=Object.assign(this.model,t.formValue),a=t.tablesValue[0].values;i.type="其它",i.subType="组装单",i.defaultNumber=i.number;var o=!0,n=!1,r=void 0;try{for(var s,l=a[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;e+=c.allPrice-0}}catch(d){n=!0,r=d}finally{try{o||null==l.return||l.return()}finally{if(n)throw r}}return i.totalPrice=e,this.fileList&&this.fileList.length>0&&(i.fileName=this.fileList),this.model.id&&(i.id=this.model.id),{info:JSON.stringify(i),rows:JSON.stringify(a)}},onAdded:function(t){var e=t.row,i=t.target;Object(d["c"])("/depot/findDepotByCurrentUser").then((function(t){if(200===t.code)for(var a=t.data,o=0;o<a.length;o++)a[o].isDefault&&i.setValues([{rowKey:e.id,values:{depotId:a[o].id+""}}])})),i.rows.length>=2?i.setValues([{rowKey:e.id,values:{mType:"普通子件"}}]):i.setValues([{rowKey:e.id,values:{mType:"组合件"}}])}}},y=p,b=i("2877"),v=Object(b["a"])(y,a,o,!1,null,"aae39c24",null);e["default"]=v.exports}}]);