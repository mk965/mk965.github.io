(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c5b3f672"],{"80fd":function(t,e,o){"use strict";o.r(e),o.d(e,"BillModalMixin",(function(){return r}));o("e2e0");var n=o("4ec3"),i=o("0fea"),a=o("ca00"),c=o("2b0e"),r={data:function(){return{action:"",manyAccountBtnStatus:!1,supList:[],cusList:[],retailList:[],personList:{options:[],value:""},depotList:[],accountList:[],accountIdList:[],accountMoneyList:[],billUnitPirce:"",spans:{labelCol1:{span:2},wrapperCol1:{span:22},labelCol1_5:{span:3},wrapperCol1_5:{span:21},labelCol2:{span:4},wrapperCol2:{span:20},labelCol3:{span:6},wrapperCol3:{span:18},labelCol6:{span:12},wrapperCol6:{span:12}}}},created:function(){},computed:{readOnly:function(){return"add"!==this.action&&"edit"!==this.action}},methods:{addInit:function(t){var e=this;Object(i["c"])("/sequence/buildNumber").then((function(o){o&&200===o.code&&e.form.setFieldsValue({number:t+o.data.defaultNumber})})),this.$nextTick((function(){e.form.setFieldsValue({operTime:Object(a["g"])(),discount:0,discountMoney:0,discountLastMoney:0,otherMoney:0,changeAmount:0,debt:0})})),this.$nextTick((function(){Object(n["ib"])({}).then((function(t){if(t&&200===t.code){var o=!0,n=!1,i=void 0;try{for(var a,c=t.data.accountList[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var r=a.value;r.isDefault&&e.form.setFieldsValue({accountId:r.id})}}catch(s){n=!0,i=s}finally{try{o||null==c.return||c.return()}finally{if(n)throw i}}}}))})),this.accountIdList=[],this.accountMoneyList=[],this.manyAccountBtnStatus=!1},initSupplier:function(){var t=this;Object(n["db"])({}).then((function(e){e&&(t.supList=e)}))},initCustomer:function(){var t=this;Object(n["bb"])({}).then((function(e){e&&(t.cusList=e)}))},initRetail:function(){var t=this;Object(n["cb"])({}).then((function(e){e&&(t.retailList=e)}))},initSalesman:function(){var t=this;Object(n["pb"])({type:1}).then((function(e){e&&(t.personList.options=e)}))},initDepot:function(){var t=this;Object(i["c"])("/depot/findDepotByCurrentUser").then((function(e){if(200===e.code){var o=e.data,n=!0,i=!1,a=void 0;try{for(var c,r=t.materialTable.columns[Symbol.iterator]();!(n=(c=r.next()).done);n=!0){var s=c.value;if("depotId"==s.key||"anotherDepotId"==s.key){s.options=[];for(var u=0;u<o.length;u++){var l={};l.value=o[u].id+"",l.text=o[u].depotName,l.title=o[u].depotName,s.options.push(l)}}}}catch(d){i=!0,a=d}finally{try{n||null==r.return||r.return()}finally{if(i)throw a}}}}))},initAccount:function(){var t=this;Object(n["ib"])({}).then((function(e){if(e&&200===e.code){var o=e.data.accountList;o.splice(0,0,{id:0,name:"多账户"}),t.accountList=o}}))},handleManyAccount:function(){this.selectAccount(0)},selectAccount:function(t){0===t?(this.$refs.manyAccountModalForm.edit(this.accountIdList,this.accountMoneyList),this.$refs.manyAccountModalForm.title="多账户结算",this.manyAccountBtnStatus=!0):(this.accountIdList=[],this.accountMoneyList=[],this.manyAccountBtnStatus=!1)},manyAccountModalFormOk:function(t,e,o){var n=this;this.accountIdList=t,this.accountMoneyList=e;var i=this.form.getFieldValue("discountLastMoney")-0,a=this.form.getFieldValue("otherMoney")-0,c=(i+a-o).toFixed(2);this.$nextTick((function(){n.form.setFieldsValue({changeAmount:o,debt:c})}))},onAdded:function(t){var e=t.row,o=t.target;Object(i["c"])("/depot/findDepotByCurrentUser").then((function(t){if(200===t.code)for(var n=t.data,i=0;i<n.length;i++)n[i].isDefault&&o.setValues([{rowKey:e.id,values:{depotId:n[i].id+""}}])}))},onValueChange:function(t){var e,o,i,r,s,u,l,d,f=this,h=this,p=(t.type,t.row),m=t.column,y=t.value,b=t.target;switch(m.key){case"depotId":p.barCode&&h.getStockByDepotBarCode(p,b);break;case"barCode":e={barCode:y,mpList:Object(a["f"])(c["a"].ls.get("materialPropertyList")),prefixNo:this.prefixNo},Object(n["mb"])(e).then((function(t){if(t&&200===t.code){var e=t.data;if(y.indexOf(",")>-1)f.$refs.materialDataTable.getValues((function(t,o){o.pop();for(var n=o,i=0;i<e.length;i++){var a=e[i],c=f.parseInfoToObj(a);c.depotId=a.depotId,c.stock=a.stock,n.push(c)}for(var r=0,s=0;s<n.length;s++)r+=n[s].taxLastMoney-0;f.materialTable.dataSource=n,b.statisticsColumns.taxLastMoney=r,h.autoChangePrice(b)}));else{for(var o=[],n=0;n<e.length;n++){var i=e[n],a={rowKey:p.id,values:f.parseInfoToObj(i)};o.push(a)}b.setValues(o),h.getStockByDepotBarCode(p,b),b.recalcAllStatisticsColumns(),h.autoChangePrice(b)}}}));break;case"operNumber":o=y-0,u=p.taxRate-0,i=p.unitPrice-0,r=p.taxUnitPrice-0,s=(i*o).toFixed(2)-0,l=(.01*u*s).toFixed(2)-0,d=(s+l).toFixed(2)-0,b.setValues([{rowKey:p.id,values:{allPrice:s,taxMoney:l,taxLastMoney:d}}]),b.recalcAllStatisticsColumns(),h.autoChangePrice(b);break;case"unitPrice":o=p.operNumber-0,i=y-0,u=p.taxRate-0,r=(i*(1+.01*u)).toFixed(2)-0,s=(i*o).toFixed(2)-0,l=(.01*u*s).toFixed(2)-0,d=(s+l).toFixed(2)-0,b.setValues([{rowKey:p.id,values:{taxUnitPrice:r,allPrice:s,taxMoney:l,taxLastMoney:d}}]),b.recalcAllStatisticsColumns(),h.autoChangePrice(b);break;case"allPrice":o=p.operNumber-0,u=p.taxRate-0,s=y-0,i=(s/o).toFixed(2)-0,r=(i*(1+.01*u)).toFixed(2)-0,l=(.01*u*s).toFixed(2)-0,d=(s+l).toFixed(2)-0,b.setValues([{rowKey:p.id,values:{unitPrice:i,taxUnitPrice:r,taxMoney:l,taxLastMoney:d}}]),b.recalcAllStatisticsColumns(),h.autoChangePrice(b);break;case"taxRate":o=p.operNumber-0,s=p.allPrice-0,i=p.unitPrice-0,u=y-0,r=(i*(1+.01*u)).toFixed(2)-0,l=(.01*u*s).toFixed(2)-0,d=(s+l).toFixed(2)-0,b.setValues([{rowKey:p.id,values:{taxUnitPrice:r,taxMoney:l,taxLastMoney:d}}]),b.recalcAllStatisticsColumns(),h.autoChangePrice(b);break;case"taxLastMoney":o=p.operNumber-0,d=y-0,u=p.taxRate-0,r=(d/o).toFixed(2)-0,i=(r/(1+.01*u)).toFixed(2)-0,s=(i*o).toFixed(2)-0,l=(d-s).toFixed(2)-0,b.setValues([{rowKey:p.id,values:{unitPrice:i,taxUnitPrice:r,allPrice:s,taxMoney:l}}]),b.recalcAllStatisticsColumns(),h.autoChangePrice(b);break}},parseInfoToObj:function(t){return{barCode:t.mBarCode,name:t.name,standard:t.standard,model:t.model,materialOther:t.materialOther,unit:t.commodityUnit,sku:t.sku,operNumber:1,unitPrice:t.billPrice,taxUnitPrice:t.billPrice,allPrice:t.billPrice,taxRate:0,taxMoney:0,taxLastMoney:t.billPrice}},onDeleted:function(t,e){e.recalcAllStatisticsColumns(),this.autoChangePrice(e)},getStockByDepotBarCode:function(t,e){Object(n["gb"])({depotId:t.depotId,barCode:t.barCode}).then((function(o){o&&200===o.code&&(e.setValues([{rowKey:t.id,values:{stock:o.data.stock}}]),e.recalcAllStatisticsColumns())}))},autoChangePrice:function(t){var e=this,o=t.statisticsColumns.taxLastMoney-0,n=this.form.getFieldValue("discount")-0,i=this.form.getFieldValue("otherMoney")-0,a=(.01*n*o).toFixed(2)-0,c=(o-a).toFixed(2)-0,r=(c+i).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({discount:n,discountMoney:a,discountLastMoney:c,changeAmount:r,debt:0})}))},onKeyUpDiscount:function(t){var e=this,o=t.target.value-0,n=this.form.getFieldValue("discountMoney")-0,i=this.form.getFieldValue("discountLastMoney")-0,a=this.form.getFieldValue("otherMoney")-0,c=(n+i).toFixed(2)-0,r=(c*o*.01).toFixed(2)-0,s=(c-r).toFixed(2)-0,u=(s+a).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({discountMoney:r,discountLastMoney:s,changeAmount:u,debt:0})}))},onKeyUpDiscountMoney:function(t){var e=this,o=t.target.value-0,n=this.form.getFieldValue("discount")-0,i=this.form.getFieldValue("discountLastMoney")-0,a=this.form.getFieldValue("otherMoney")-0;if(100!==n){var c=(i/(1-n/100)).toFixed(2)-0,r=(o/c*100).toFixed(2)-0,s=(c-o).toFixed(2)-0,u=(s+a).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({discount:r,discountLastMoney:s,changeAmount:u,debt:0})}))}},onKeyUpOtherMoney:function(t){var e=this,o=t.target.value-0,n=this.form.getFieldValue("discountLastMoney")-0,i=(n+o).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({changeAmount:i,debt:0})}))},onKeyUpChangeAmount:function(t){var e=this,o=t.target.value-0,n=this.form.getFieldValue("discountLastMoney")-0,i=this.form.getFieldValue("otherMoney")-0,a=(n+i-o).toFixed(2)-0;this.$nextTick((function(){e.form.setFieldsValue({debt:a})}))}}}},e2e0:function(t,e,o){"use strict";function n(t){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}o.d(e,"a",(function(){return i})),o.d(e,"b",(function(){return a})),o.d(e,"c",(function(){return c})),o.d(e,"d",(function(){return r}));var i={normal:"normal",input:"input",inputNumber:"inputNumber",checkbox:"checkbox",select:"select",date:"date",datetime:"datetime",upload:"upload",file:"file",image:"image",popup:"popup",popupJsh:"popupJsh",list_multi:"list_multi",sel_search:"sel_search",radio:"radio",checkbox_meta:"checkbox_meta",input_pop:"input_pop",slot:"slot",hidden:"hidden"},a=Symbol();function c(t,e){return new Promise((function(o){(function n(){var i=t.$refs[e];i?o(i):setTimeout((function(){n()}),10)})()}))}function r(t,e){if(!t||"function"!==typeof t.validateFields)throw"form 参数需要的是一个form对象，而传入的却是".concat(n(t));var o={};return new Promise((function(e,o){t.validateFields((function(t,n){t?o({error:a}):e(n)}))})).then((function(t){return Object.assign(o,{formValue:t}),s(e)})).then((function(t){return Object.assign(o,{tablesValue:t}),Promise.resolve(o)})).catch((function(t){return Promise.reject(t)}))}function s(t,e){if(!(t instanceof Array))throw"'validateTables'函数的'cases'参数需要的是一个数组，而传入的却是".concat(n(t));return new Promise((function(o,n){var i=[],c=0;t&&0!=t.length||o(),function r(){var s=t[c];s.getAll(!0,e).then((function(e){i[c]=e,++c===t.length?o(i):r()}),(function(t){t===a&&n({error:a,index:c}),n(t)}))}()}))}}}]);