(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d736f39c","chunk-2d0e55b5","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d0df437","chunk-2d225b46"],{4319:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{staticStyle:{top:"5%",height:"100%","overflow-y":"hidden"},attrs:{title:e.title,width:1200,visible:e.visible,confirmLoading:e.confirmLoading,cancelText:"关闭",wrapClassName:"ant-modal-cust-warp"},on:{ok:e.handleOk,cancel:e.handleCancel}},[a("template",{slot:"footer"},[e.isReadOnly?a("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("\n      关闭\n    ")]):e._e()],1),a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-tabs",{attrs:{"default-active-key":"1"}},[a("a-tab-pane",{key:"1",attrs:{tab:"基本信息",forceRender:""}},[a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"名称"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["name",e.validatorRules.name],expression:"[ 'name', validatorRules.name]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入名称"}})],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"规格"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["standard"],expression:"[ 'standard' ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入规格"}})],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"单位"}},[a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:13,md:13,sm:24}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["unit"],expression:"[ 'unit' ]",modifiers:{trim:!0}}],attrs:{placeholder:"输入单位",hidden:e.unitStatus},on:{change:e.onlyUnitOnChange}}),a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["unitId"],expression:"[ 'unitId' ]"}],attrs:{value:e.unitList,placeholder:"选择单位",hidden:e.manyUnitStatus,dropdownMatchSelectWidth:!1},on:{change:e.manyUnitOnChange}},e._l(e.unitList,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.id}},[e._v("\n                        "+e._s(t.name)+"\n                      ")])})),1)],1),a("a-col",{attrs:{lg:11,md:11,sm:24}},[a("a-checkbox",{attrs:{checked:e.unitChecked},on:{change:e.unitOnChange}},[e._v("多单位")])],1)],1)],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"型号"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["model"],expression:"[ 'model' ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入型号"}})],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"颜色"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["color"],expression:"[ 'color' ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入颜色"}})],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"类别"}},[a("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["categoryId"],expression:"[ 'categoryId' ]"}],staticStyle:{width:"100%"},attrs:{dropdownStyle:{maxHeight:"200px",overflow:"auto"},"allow-clear":"",treeData:e.categoryTree,placeholder:"请选择类别"}})],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"序列号"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["enableSerialNumber"],expression:"[ 'enableSerialNumber' ]"}],attrs:{placeholder:"有无序列号"}},[a("a-select-option",{attrs:{value:"1"}},[e._v("有")]),a("a-select-option",{attrs:{value:"0"}},[e._v("无")])],1)],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"安全存量"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["safetyStock"],expression:"[ 'safetyStock' ]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入安全存量"}})],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"多属性"}},[a("a-switch",{attrs:{"checked-children":"启用","un-checked-children":"关闭"},on:{change:e.onSkuChange},model:{value:e.skuSwitch,callback:function(t){e.skuSwitch=t},expression:"skuSwitch"}})],1)],1)],1),e.skuSwitch?a("a-card",[a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.sku.manyColor}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["manyColor"],expression:"[ 'manyColor' ]"}],attrs:{mode:"multiple",showSearch:"",optionFilterProp:"children"}},e._l(e.sku.manyColorList,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.value}},[e._v("\n                      "+e._s(t.name)+"\n                    ")])})),1)],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.sku.manySize}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["manySize"],expression:"[ 'manySize' ]"}],attrs:{mode:"multiple",showSearch:"",optionFilterProp:"children"}},e._l(e.sku.manySizeList,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.value}},[e._v("\n                      "+e._s(t.name)+"\n                    ")])})),1)],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.sku.other1}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["other1"],expression:"[ 'other1' ]"}],attrs:{mode:"multiple",showSearch:"",optionFilterProp:"children"}},e._l(e.sku.other1List,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.value}},[e._v("\n                      "+e._s(t.name)+"\n                    ")])})),1)],1)],1)],1),a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.sku.other2}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["other2"],expression:"[ 'other2' ]"}],attrs:{mode:"multiple",showSearch:"",optionFilterProp:"children"}},e._l(e.sku.other2List,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.value}},[e._v("\n                      "+e._s(t.name)+"\n                    ")])})),1)],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.sku.other3}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["other3"],expression:"[ 'other3' ]"}],attrs:{mode:"multiple",showSearch:"",optionFilterProp:"children"}},e._l(e.sku.other3List,(function(t,i){return a("a-select-option",{key:i,attrs:{value:t.value}},[e._v("\n                      "+e._s(t.name)+"\n                    ")])})),1)],1)],1),a("a-col",{attrs:{lg:8,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"生成条码"}},[a("a-switch",{on:{change:e.onBarCodeChange},model:{value:e.barCodeSwitch,callback:function(t){e.barCodeSwitch=t},expression:"barCodeSwitch"}})],1)],1)],1)],1):e._e(),a("div",{staticStyle:{"margin-top":"8px"}},[a("j-editable-table",{ref:"editableMeTable",attrs:{loading:e.meTable.loading,columns:e.meTable.columns,dataSource:e.meTable.dataSource,maxHeight:300,rowNumber:!0,rowSelection:!0,actionButton:!0},on:{added:e.onAdded},scopedSlots:e._u([{key:"buttonAfter",fn:function(){return[a("a-button",{on:{click:function(t){return e.batchSet("purchase")}}},[e._v("采购价-批量")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.batchSet("commodity")}}},[e._v("零售价-批量")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.batchSet("wholesale")}}},[e._v("销售价-批量")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.batchSet("low")}}},[e._v("最低售价-批量")])]},proxy:!0}])}),a("batch-set-price-modal",{ref:"modalForm",on:{ok:e.batchSetPricemodalFormOk}})],1),a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:24,md:24,sm:24}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:{xs:{span:24},sm:{span:24}},label:""}},[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["remark"],expression:"[ 'remark' ]"}],staticStyle:{"margin-top":"8px"},attrs:{rows:2,placeholder:"请输入备注"}})],1)],1)],1)],1),a("a-tab-pane",{key:"2",attrs:{tab:"扩展信息",forceRender:""}},[e.mpShort.mfrs.enabled?a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:8,sm:8}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.mpShort.mfrs.name}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["mfrs"],expression:"[ 'mfrs' ]",modifiers:{trim:!0}}]})],1)],1)],1):e._e(),e.mpShort.otherField1.enabled?a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:8,sm:8}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.mpShort.otherField1.name}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["otherField1"],expression:"[ 'otherField1' ]",modifiers:{trim:!0}}]})],1)],1)],1):e._e(),e.mpShort.otherField2.enabled?a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:8,sm:8}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.mpShort.otherField2.name}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["otherField2"],expression:"[ 'otherField2' ]",modifiers:{trim:!0}}]})],1)],1)],1):e._e(),e.mpShort.otherField3.enabled?a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:8,md:8,sm:8}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:e.mpShort.otherField3.name}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["otherField3"],expression:"[ 'otherField3' ]",modifiers:{trim:!0}}]})],1)],1)],1):e._e()],1),a("a-tab-pane",{key:"3",attrs:{tab:"初始库存",forceRender:""}},[a("j-editable-table",{ref:"editableDepotTable",attrs:{loading:e.depotTable.loading,columns:e.depotTable.columns,dataSource:e.depotTable.dataSource,maxHeight:300,rowNumber:!0,rowSelection:!1,actionButton:!1}})],1),a("a-tab-pane",{key:"4",attrs:{tab:"图片信息",forceRender:""}},[a("a-row",{staticClass:"form-row",attrs:{gutter:24}},[a("a-col",{attrs:{lg:12,md:12,sm:24}},[a("a-form-item",{attrs:{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}},label:"图片信息"}},[a("j-image-upload",{attrs:{bizPath:"material",text:"上传",isMultiple:""},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}})],1)],1),a("a-col",{attrs:{lg:12,md:12,sm:24}})],1)],1)],1)],1)],1)],2)},r=[],l=a("88bc"),o=a.n(l),n=a("93af"),s=a("7550"),d=a("e2e0"),c=a("4ec3"),u=a("0fea"),m=a("e610"),h=a("2dab"),p=a("2b0e");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){g(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function g(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var v={name:"MaterialModal",components:{BatchSetPriceModal:n["default"],JImageUpload:m["default"],JDate:h["default"],JEditableTable:s["default"]},data:function(){return{title:"操作",visible:!1,categoryTree:[],unitList:[],depotList:[],fileList:[],unitStatus:!1,manyUnitStatus:!0,unitChecked:!1,skuSwitch:!1,barCodeSwitch:!1,maxBarCodeInfo:"",sku:{manyColor:"多颜色",manySize:"多尺寸",other1:"自定义1",other2:"自定义2",other3:"自定义3",manyColorList:[],manySizeList:[],other1List:[],other2List:[],other3List:[]},model:{},isReadOnly:!1,labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}},mpShort:{mfrs:{},otherField1:{},otherField2:{},otherField3:{}},meTable:{loading:!1,dataSource:[],columns:[{title:"条码",key:"barCode",width:"20%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"},{pattern:/^[1-9]\d*$/,message:"请输入零以上的正整数"},{pattern:/^\d{4,13}$/,message:"4到13位数字"},{handler:this.validateBarCode}]},{title:"单位",key:"commodityUnit",width:"10%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}",validateRules:[{required:!0,message:"${title}不能为空"}]},{title:"多属性",key:"sku",width:"12%",type:d["a"].input,defaultValue:"",readonly:!0,placeholder:"点击生成条码赋值"},{title:"采购价",key:"purchaseDecimal",width:"12%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}"},{title:"零售价",key:"commodityDecimal",width:"12%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}"},{title:"销售价",key:"wholesaleDecimal",width:"12%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}"},{title:"最低售价",key:"lowDecimal",width:"12%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}"}]},depotTable:{loading:!1,dataSource:[],columns:[{title:"仓库",key:"name",width:"15%",type:d["a"].normal},{title:"库存数量",key:"initStock",width:"15%",type:d["a"].input,defaultValue:"",placeholder:"请输入${title}"}]},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{name:{rules:[{required:!0,message:"请输入名称!"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}]},unit:{rules:[{required:!0,message:"请输入单位!"}]}},url:{add:"/material/add",edit:"/material/update",materialsExtendList:"/materialsExtend/getDetailList",depotWithStock:"/depot/getAllListWithStock"}}},created:function(){this.maxBarCodeAction(),this.loadTreeData(),this.loadUnitListData(),this.loadParseMaterialProperty()},methods:{getAllTable:function(){return Promise.all([Object(d["c"])(this,"editableMeTable"),Object(d["c"])(this,"editableDepotTable")])},add:function(){this.meTable.columns[2].type=d["a"].hidden,this.getAllTable().then((function(e){e[0].add()})),this.edit({})},edit:function(e){var t=this;if(this.form.resetFields(),this.model=Object.assign({},e),this.activeKey="1",this.skuSwitch=!1,this.barCodeSwitch=!1,this.visible=!0,"{}"===JSON.stringify(e)?this.fileList=[]:setTimeout((function(){t.fileList=e.imgName}),5),this.$nextTick((function(){t.form.setFieldsValue(o()(t.model,"name","standard","unit","unitId","model","color","categoryId","enableSerialNumber","safetyStock","remark","mfrs","otherField1","otherField2","otherField3"))})),this.initMaterialAttribute(),this.model.id){this.model.unit?(this.unitChecked=!1,this.unitStatus=!1,this.manyUnitStatus=!0):(this.unitChecked=!0,this.unitStatus=!0,this.manyUnitStatus=!1);var a={materialId:this.model.id};this.requestMeTableData(this.url.materialsExtendList,a,this.meTable),this.requestDepotTableData(this.url.depotWithStock,{mId:this.model.id},this.depotTable)}else this.requestDepotTableData(this.url.depotWithStock,{mId:0},this.depotTable)},requestMeTableData:function(e,t,a){var i=this;a.loading=!0,Object(u["c"])(e,t).then((function(e){for(var t=0;t<e.data.rows.length;t++)e.data.rows[t].sku?i.meTable.columns[2].type=d["a"].input:i.meTable.columns[2].type=d["a"].hidden;a.dataSource=e.data.rows||[]})).finally((function(){a.loading=!1}))},requestDepotTableData:function(e,t,a){a.loading=!0,Object(u["c"])(e,t).then((function(e){a.dataSource=e.data||[]})).finally((function(){a.loading=!1}))},close:function(){this.$emit("close"),this.visible=!1,this.unitStatus=!1,this.manyUnitStatus=!0,this.unitChecked=!1,this.getAllTable().then((function(e){e[0].initialize(),e[1].initialize()}))},handleOk:function(){this.validateFields()},handleCancel:function(){this.close()},validateFields:function(){var e=this;this.getAllTable().then((function(t){return Object(d["d"])(e.form,t)})).then((function(t){var a=e.classifyIntoFormData(t);return a.sortList=[],void 0===a.unit&&(a.unit=""),void 0===a.unitId&&(a.unitId=""),e.unitChecked?a.unit="":a.unitId="",e.requestAddOrEdit(a)})).catch((function(t){t.error===d["b"]&&(e.activeKey=null==t.index?e.activeKey:(t.index+1).toString())}))},classifyIntoFormData:function(e){var t=Object.assign(this.model,e.formValue);return b({},t,{meList:e.tablesValue[0].values,stock:e.tablesValue[1].values})},requestAddOrEdit:function(e){var t=this;if(""!==e.unit||""!==e.unitId)if(0!==e.meList.length){var a={id:this.model.id?this.model.id:0,name:this.model.name,model:this.parseParam(this.model.model),color:this.parseParam(this.model.color),standard:this.parseParam(this.model.standard),mfrs:this.parseParam(this.model.mfrs),otherField1:this.parseParam(this.model.otherField1),otherField2:this.parseParam(this.model.otherField2),otherField3:this.parseParam(this.model.otherField3),unit:this.parseParam(this.model.unit),unitId:this.parseParam(this.model.unitId)};Object(c["u"])(a).then((function(a){if(a&&200===a.code){if(a.data.status)return void t.$message.warning("抱歉，该商品已存在！");var i="";if(e.unitId)for(var r=0;r<t.unitList.length;r++)t.unitList[r].id==e.unitId&&(i=t.unitList[r].name);var l=i.substring(0,i.indexOf("(")),o=l.split(",");if(!e.unit){if(e.meList.length<2)return void t.$message.warning("多单位的商品条码行数至少要有两行，请再新增一行条码信息！");if(e.meList[0].commodityUnit!=o[0])return void t.$message.warning("条码之后的单位填写有误，单位【"+e.meList[0].commodityUnit+"】请修改为【"+o[0]+"】！");if(e.meList[1].commodityUnit!=o[1])return void t.$message.warning("条码之后的单位填写有误，单位【"+e.meList[1].commodityUnit+"】请修改为【"+o[1]+"】！")}for(var n=0;n<e.meList.length;n++){var s=e.meList[n].commodityUnit;if(e.unit){if(s!=e.unit)return void t.$message.warning("条码之后的单位填写有误，单位【"+s+"】请修改为【"+e.unit+"】！")}else if(i&&s!=o[0]&&s!=o[1])return void t.$message.warning("条码之后的单位填写有误，单位【"+s+"】请修改为【"+o[0]+"】或【"+o[1]+"】！")}t.fileList&&t.fileList.length>0?e.imgName=t.fileList:e.imgName="";var d=t.url.add,c="post";t.model.id&&(d=t.url.edit,c="put");var m=t;t.confirmLoading=!0,Object(u["e"])(d,e,c).then((function(e){200===e.code?(m.$emit("ok"),m.confirmLoading=!1,m.close()):(m.$message.warning(e.data.message),m.confirmLoading=!1)})).finally((function(){}))}}))}else this.$message.warning("抱歉，请输入条码信息！");else this.$message.warning("抱歉，单位为必填项！")},parseParam:function(e){return e||""},validateBarCode:function(e,t,a,i,r,l){var o={barCode:t,id:a.id.length>=20?0:a.id};Object(c["w"])(o).then((function(e){e&&200===e.code?e.data.status?r(!1,"该条码已经存在"):r(!0):r(!1,e.data)}))},maxBarCodeAction:function(){var e=this;Object(c["ob"])({}).then((function(t){t&&200===t.code&&(e.maxBarCodeInfo=t.data.barCode-0)}))},loadTreeData:function(){var e=this,t={id:""};Object(c["vb"])(t).then((function(t){if(t){e.categoryTree=[];for(var a=0;a<t.length;a++){var i=t[a];e.categoryTree.push(i)}}}))},loadUnitListData:function(){var e=this,t={currentPage:1,pageSize:100};Object(u["c"])("/unit/list",t).then((function(t){t&&(e.unitList=t.data.rows)}))},onSkuChange:function(e){this.skuSwitch=e,e?(this.meTable.columns[2].type=d["a"].input,this.form.setFieldsValue({color:""})):this.meTable.columns[2].type=d["a"].hidden},onBarCodeChange:function(e){var t=this,a=this.form.getFieldValue("unit");if(a)if(e){var i=this.getNumByField("manyColor")+this.getNumByField("manySize")+this.getNumByField("other1")+this.getNumByField("other2")+this.getNumByField("other3");if(2===i){var r=[];this.getNumByField("manyColor")&&r.push(this.form.getFieldValue("manyColor")),this.getNumByField("manySize")&&r.push(this.form.getFieldValue("manySize")),this.getNumByField("other1")&&r.push(this.form.getFieldValue("other1")),this.getNumByField("other2")&&r.push(this.form.getFieldValue("other2")),this.getNumByField("other3")&&r.push(this.form.getFieldValue("other3"));for(var l=r[0],o=r[1],n=[],s=0;s<l.length;s++)for(var d=0;d<o.length;d++)n.push(l[s]+","+o[d]);var u=[];Object(c["ob"])({}).then((function(e){if(e&&200===e.code){for(var i=e.data.barCode-0,r=0;r<n.length;r++){var l=i+r+1;u.push({barCode:l,commodityUnit:a,sku:n[r]})}t.meTable.dataSource=u}}))}else this.$message.warning("请选择两个属性！"),this.barCodeSwitch=!1}else this.meTable.dataSource=[];else this.$message.warning("请填写单位，注意不要勾选多单位！"),this.barCodeSwitch=!1},getNumByField:function(e){var t=0;return this.form.getFieldValue(e)&&this.form.getFieldValue(e).length>0&&(t=1),t},onAdded:function(e){var t=e.row,a=e.target,i="";0==this.unitStatus&&(i=this.form.getFieldValue("unit")),this.maxBarCodeInfo=this.maxBarCodeInfo+1,a.setValues([{rowKey:t.id,values:{barCode:this.maxBarCodeInfo,commodityUnit:i||""}}])},batchSet:function(e){this.skuSwitch||this.model.id?(this.$refs.modalForm.add(e),this.$refs.modalForm.disableSubmit=!1):this.$message.warning("抱歉，只有开启多属性才能进行批量操作！")},batchSetPricemodalFormOk:function(e,t){var a=this.meTable.dataSource;if(0===a.length)this.$message.warning("请先录入条码、单位等信息！");else{for(var i=[],r=0;r<a.length;r++){var l={barCode:a[r].barCode,commodityUnit:a[r].commodityUnit,sku:a[r].sku,purchaseDecimal:a[r].purchaseDecimal,commodityDecimal:a[r].commodityDecimal,wholesaleDecimal:a[r].wholesaleDecimal,lowDecimal:a[r].lowDecimal};"purchase"===t?l.purchaseDecimal=e-0:"commodity"===t?l.commodityDecimal=e-0:"wholesale"===t?l.wholesaleDecimal=e-0:"low"===t&&(l.lowDecimal=e-0),a[r].id&&(l.id=a[r].id),i.push(l)}this.meTable.dataSource=i}},initMaterialAttribute:function(){var e=this;Object(c["jb"])({}).then((function(t){t&&200===t.code&&t.data&&(e.sku.manyColor=t.data.manyColorName,e.sku.manySize=t.data.manySizeName,e.sku.other1=t.data.other1Name,e.sku.other2=t.data.other2Name,e.sku.other3=t.data.other3Name,e.sku.manyColorList=t.data.manyColorValue,e.sku.manySizeList=t.data.manySizeValue,e.sku.other1List=t.data.other1Value,e.sku.other2List=t.data.other2Value,e.sku.other3List=t.data.other3Value)}))},loadParseMaterialProperty:function(){for(var e=p["a"].ls.get("materialPropertyList"),t=0;t<e.length;t++)"制造商"===e[t].nativeName&&(this.mpShort.mfrs.name=e[t].anotherName,this.mpShort.mfrs.enabled=e[t].enabled),"自定义1"===e[t].nativeName&&(this.mpShort.otherField1.name=e[t].anotherName,this.mpShort.otherField1.enabled=e[t].enabled),"自定义2"===e[t].nativeName&&(this.mpShort.otherField2.name=e[t].anotherName,this.mpShort.otherField2.enabled=e[t].enabled),"自定义3"===e[t].nativeName&&(this.mpShort.otherField3.name=e[t].anotherName,this.mpShort.otherField3.enabled=e[t].enabled)},onlyUnitOnChange:function(e){var t=this;this.$refs.editableMeTable.getValues((function(a,i){for(var r=i,l=0;l<r.length;l++){var o=r[l];o.commodityUnit=e.target.value}t.meTable.dataSource=r}))},manyUnitOnChange:function(e){for(var t=this,a=this.unitList,i="",r="",l=0;l<a.length;l++)a[l].id===e&&(i=a[l].basicUnit,r=a[l].otherUnit);this.$refs.editableMeTable.getValues((function(e,a){for(var l=a,o=0;o<l.length;o++){var n=l[o];n.commodityUnit=0===o?i:r}t.meTable.dataSource=l}))},unitOnChange:function(e){var t=e.target.checked;t?(this.unitStatus=!0,this.manyUnitStatus=!1,this.unitChecked=!0):(this.unitStatus=!1,this.manyUnitStatus=!0,this.unitChecked=!1)}}},w=v,y=a("2877"),C=Object(y["a"])(w,i,r,!1,null,"2df68113",null);t["default"]=C.exports},"88bc":function(e,t,a){(function(t){var a=1/0,i=9007199254740991,r="[object Arguments]",l="[object Function]",o="[object GeneratorFunction]",n="[object Symbol]",s="object"==typeof t&&t&&t.Object===Object&&t,d="object"==typeof self&&self&&self.Object===Object&&self,c=s||d||Function("return this")();function u(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}function m(e,t){var a=-1,i=e?e.length:0,r=Array(i);while(++a<i)r[a]=t(e[a],a,e);return r}function h(e,t){var a=-1,i=t.length,r=e.length;while(++a<i)e[r+a]=t[a];return e}var p=Object.prototype,f=p.hasOwnProperty,b=p.toString,g=c.Symbol,v=p.propertyIsEnumerable,w=g?g.isConcatSpreadable:void 0,y=Math.max;function C(e,t,a,i,r){var l=-1,o=e.length;a||(a=F),r||(r=[]);while(++l<o){var n=e[l];t>0&&a(n)?t>1?C(n,t-1,a,i,r):h(r,n):i||(r[r.length]=n)}return r}function S(e,t){return e=Object(e),k(e,t,(function(t,a){return a in e}))}function k(e,t,a){var i=-1,r=t.length,l={};while(++i<r){var o=t[i],n=e[o];a(n,o)&&(l[o]=n)}return l}function L(e,t){return t=y(void 0===t?e.length-1:t,0),function(){var a=arguments,i=-1,r=y(a.length-t,0),l=Array(r);while(++i<r)l[i]=a[t+i];i=-1;var o=Array(t+1);while(++i<t)o[i]=a[i];return o[t]=l,u(e,this,o)}}function F(e){return N(e)||O(e)||!!(w&&e&&e[w])}function x(e){if("string"==typeof e||U(e))return e;var t=e+"";return"0"==t&&1/e==-a?"-0":t}function O(e){return T(e)&&f.call(e,"callee")&&(!v.call(e,"callee")||b.call(e)==r)}var N=Array.isArray;function j(e){return null!=e&&P(e.length)&&!_(e)}function T(e){return D(e)&&j(e)}function _(e){var t=$(e)?b.call(e):"";return t==l||t==o}function P(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function $(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function D(e){return!!e&&"object"==typeof e}function U(e){return"symbol"==typeof e||D(e)&&b.call(e)==n}var V=L((function(e,t){return null==e?{}:S(e,m(C(t,1),x))}));e.exports=V}).call(this,a("c8ba"))},"93af":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{staticStyle:{top:"35%",height:"30%","overflow-y":"hidden"},attrs:{title:e.title,width:500,visible:e.visible,"confirm-loading":e.confirmLoading,cancelText:"关闭",wrapClassName:"ant-modal-cust-warp"},on:{ok:e.handleOk,cancel:e.handleCancel}},[a("template",{slot:"footer"},[e.isReadOnly?a("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("\n      关闭\n    ")]):e._e()],1),a("a-spin",{attrs:{spinning:e.confirmLoading}},[a("a-form",{attrs:{form:e.form}},[a("a-form-item",{attrs:{labelCol:e.labelCol,wrapperCol:e.wrapperCol,label:"请输入价格"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator.trim",value:["price",e.validatorRules.price],expression:"[ 'price', validatorRules.price]",modifiers:{trim:!0}}],attrs:{placeholder:"请输入价格"}})],1)],1)],1)],2)},r=[],l={name:"BatchSetPriceModal",data:function(){return{title:"批量设置",visible:!1,isReadOnly:!1,batchType:"",model:{},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},confirmLoading:!1,form:this.$form.createForm(this),validatorRules:{price:{rules:[{required:!0,message:"请输入价格!"}]}}}},created:function(){},methods:{add:function(e){this.batchType=e,"purchase"===e?this.title="采购价-批量设置":"commodity"===e?this.title="零售价-批量设置":"wholesale"===e?this.title="销售价-批量设置":"low"===e&&(this.title="最低售价-批量设置"),this.edit({})},edit:function(e){this.form.resetFields(),this.model=Object.assign({},e),this.visible=!0},close:function(){this.$emit("close"),this.visible=!1},handleOk:function(){var e=this.form.getFieldValue("price");this.$emit("ok",e,this.batchType),this.visible=!1},handleCancel:function(){this.close()}}},o=l,n=a("2877"),s=Object(n["a"])(o,i,r,!1,null,"1afb89e7",null);t["default"]=s.exports},e610:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-upload",{attrs:{name:"file",listType:"picture-card",multiple:e.isMultiple,action:e.uploadAction,headers:e.headers,data:{biz:e.bizPath},fileList:e.fileList,beforeUpload:e.beforeUpload,disabled:e.disabled,isMultiple:e.isMultiple,showUploadList:e.isMultiple},on:{change:e.handleChange,preview:e.handlePreview}},[!e.isMultiple&&e.picUrl?a("img",{staticStyle:{height:"104px","max-width":"300px"},attrs:{src:e.getAvatarView()}}):a("div",[a("a-icon",{attrs:{type:e.uploadLoading?"loading":"plus"}}),a("div",{staticClass:"ant-upload-text"},[e._v(e._s(e.text))])],1),a("a-modal",{attrs:{visible:e.previewVisible,footer:null},on:{cancel:function(t){return e.handleCancel()}}},[a("img",{staticStyle:{width:"100%"},attrs:{alt:"example",src:e.previewImage}})])],1)},r=[],l=a("2b0e"),o=a("9fb0"),n=a("0fea"),s=a("4ec3"),d=function(){return"-"+parseInt(1e4*Math.random()+1,10)},c=function(e){if(e.lastIndexOf("\\")>=0){var t=new RegExp("\\\\","g");e=e.replace(t,"/")}return e.substring(e.lastIndexOf("/")+1)},u={name:"JImageUpload",data:function(){return{uploadAction:window._CONFIG["domianURL"]+"/systemConfig/upload",uploadLoading:!1,picUrl:!1,headers:{},fileList:[],previewImage:"",previewVisible:!1,sizeLimit:0,uploadGoOn:!0}},props:{text:{type:String,required:!1,default:"上传"},bizPath:{type:String,required:!1,default:"temp"},value:{type:[String,Array],required:!1},disabled:{type:Boolean,required:!1,default:!1},isMultiple:{type:Boolean,required:!1,default:!1}},watch:{value:function(e){e instanceof Array?this.initFileList(e.join(",")):this.initFileList(e)}},created:function(){this.initFileSizeLimit();var e=l["a"].ls.get(o["a"]);this.headers={Authorization:e}},methods:{initFileSizeLimit:function(){var e=this;Object(s["Z"])().then((function(t){200===t.code&&(e.sizeLimit=t.data)}))},initFileList:function(e){if(!e||0==e.length)return this.fileList=[],void(this.picUrl=!1);this.picUrl=!0;for(var t=[],a=e.split(","),i=0;i<a.length;i++){var r=Object(n["d"])("systemConfig/static/"+a[i]);t.push({uid:d(),name:c(a[i]),status:"done",url:r,response:{code:"history",data:a[i]}})}this.fileList=t},beforeUpload:function(e){this.uploadGoOn=!0;var t=e.type,a=e.size;if(t.indexOf("image")<0)return this.$message.warning("请上传图片"),this.uploadGoOn=!1,!1;if(a>this.sizeLimit){var i=(this.sizeLimit/1024/1024).toFixed(2);return this.$message.warning("抱歉，图片大小不能超过"+i+"M"),this.uploadGoOn=!1,!1}return!0},handleChange:function(e){e.file.status||!1!==this.uploadGoOn||e.fileList.pop(),this.picUrl=!1;var t=e.fileList;"done"===e.file.status?200===e.file.response.code&&(this.picUrl=!0,t=t.map((function(e){return e.response&&(e.url=e.response.data),e}))):"error"===e.file.status?this.$message.error("".concat(e.file.name," 上传失败.")):"removed"===e.file.status&&this.handleDelete(e.file),this.fileList=t,"done"!==e.file.status&&"removed"!==e.file.status||this.handlePathChange()},handlePreview:function(e){this.previewImage=e.url||e.thumbUrl,this.previewVisible=!0},getAvatarView:function(){if(this.fileList.length>0){var e=this.fileList[0].url;return e}},handlePathChange:function(){var e=this.fileList,t="";e&&0!=e.length||(t="");var a=[];if(this.isMultiple)for(var i=0;i<e.length;i++)a.push(e[i].response.data);else a.push(e[e.length-1].response.data);a.length>0&&(t=a.join(",")),this.$emit("change",t)},handleDelete:function(e){},handleCancel:function(){this.close(),this.previewVisible=!1},close:function(){}},model:{prop:"value",event:"change"}},m=u,h=a("2877"),p=Object(h["a"])(m,i,r,!1,null,"1eef12ac",null);t["default"]=p.exports}}]);